(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4224"],{BZ7v:function(t,e,s){"use strict";var i=s("hAkP");s.n(i).a},hAkP:function(t,e,s){},kFvY:function(t,e,s){"use strict";s.r(e);var i=s("f0Pt"),a=s.n(i),o=s("KTTK"),n=s("7Qib"),l=s("ViDN"),r=s("utuE"),c=s("1RnH"),m={components:{CreateView:l.a,membersDep:r.a,relatedBusiness:c.a},computed:{crmFileSaveUrl:function(){return o.f},httpHeader:function(){return{"Admin-Token":a.a.defaults.headers["Admin-Token"]}}},data:function(){return{activeName:"1",tabsData:[{label:"日报",key:"1"},{label:"周报",key:"2"},{label:"月报",key:"3"}],formList:[],dateList:[{label:"今日工作内容",model:"content"},{label:"明日工作内容",model:"tomorrow"},{label:"遇到的问题",model:"question"}],weekList:[{label:"本周工作内容",model:"content"},{label:"下周工作内容",model:"tomorrow"},{label:"遇到的问题",model:"question"}],monthList:[{label:"本月工作内容",model:"content"},{label:"下月工作内容",model:"tomorrow"},{label:"遇到的问题",model:"question"}],batchId:Object(n.h)(),imageFileList:[],fileList:[],dialogVisible:!1,relevanceAll:{},allData:{}}},props:{formData:{type:Object,default:function(){return{}}},dialogTitle:{type:String,default:"写日志"},accessoryFileList:{type:Array,default:function(){return[]}},imgFileList:{type:Array,default:function(){return[]}},newLoading:Boolean},mounted:function(){if(document.body.appendChild(this.$el),this.formList=this.dateList,this.formData.categoryId)switch(this.formData.categoryId){case 1:this.tabsData=[{label:"日报",key:"1"}],this.formList=this.dateList;break;case 2:this.tabsData=[{label:"周报",key:"1"}],this.formList=this.weekList;break;case 3:this.tabsData=[{label:"月报",key:"1"}],this.formList=this.monthList}"写日志"!=this.dialogTitle&&this.formData.batchId&&(this.batchId=this.formData.batchId);var t={};t.business=this.formData.businessList?this.formData.businessList:[],t.contacts=this.formData.contactsList?this.formData.contactsList:[],t.contract=this.formData.contractList?this.formData.contractList:[],t.customer=this.formData.customerList?this.formData.customerList:[],this.allData=t;var e={};e.businessIds=this.formData.businessList?this.formData.businessList.map(function(t,e,s){return t.businessId}):[],e.contactsIds=this.formData.contactsList?this.formData.contactsList.map(function(t,e,s){return t.contactsId}):[],e.contractIds=this.formData.contractList?this.formData.contractList.map(function(t,e,s){return t.contractId}):[],e.customerIds=this.formData.customerList?this.formData.customerList.map(function(t,e,s){return t.customerId}):[],this.relevanceAll=e,this.imageFileList=this.imgFileList.map(function(t,e,s){return t.url=t.filePath,t}),this.fileList=this.accessoryFileList.map(function(t,e,s){return t.url=t.filePath,t})},methods:{close:function(){1==this.$route.query.routerKey?this.$router.go(-1):this.$emit("close")},tabClick:function(){switch(this.activeName){case"1":this.formList=this.dateList;break;case"2":this.formList=this.weekList;break;case"3":this.formList=this.monthList}},submitBtn:function(){this.formData.content||this.formData.tomorrow||this.formData.question?this.$emit("submitBtn",this.activeName,this.batchId,this.relevanceAll):this.$message.error("内容至少填写一项")},imgFileUploadSuccess:function(t,e,s){this.imageFileList=s},handleFilePreview:function(t){if(t.response||t.fileId){var e=void 0;e=t.response?t.response:{url:t.filePath,name:t.name},this.$bus.emit("preview-image-bus",{index:0,data:[e]})}},beforeRemove:function(t,e){var s=this;if(t.response||t.fileId){var i=void 0;return i=t.response?t.response.fileId:t.fileId,this.$confirm("您确定要删除该文件吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(o.c)({id:i}).then(function(t){s.$message.success("操作成功");var e=s.getFileIndex(s.$refs.imageUpload.uploadFiles,i);-1!=e&&s.$refs.imageUpload.uploadFiles.splice(e,1),-1!=(e=s.getFileIndex(s.imgFileList,i))&&s.imgFileList.splice(e,1)}).catch(function(){})}).catch(function(){s.$message({type:"info",message:"已取消操作"})}),!1}return!0},getFileIndex:function(t,e){for(var s=-1,i=0;i<t.length;i++){var a=t[i];if((a.response?a.response.fileId:a.fileId)==e){s=i;break}}return s},fileUploadSuccess:function(t,e,s){this.fileList=s},handleFileRemove:function(t,e){var s=this;if(t.response||t.fileId){var i=void 0;return i=t.response?t.response.fileId:t.fileId,this.$confirm("您确定要删除该文件吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(o.c)({id:i}).then(function(t){s.$message.success("操作成功");var e=s.getFileIndex(s.$refs.fileUpload.uploadFiles,i);-1!=e&&s.$refs.fileUpload.uploadFiles.splice(e,1),-1!=(e=s.getFileIndex(s.fileList,i))&&s.fileList.splice(e,1)}).catch(function(){})}).catch(function(){s.$message({type:"info",message:"已取消操作"})}),!1}return!0},popoverSubmit:function(t,e){this.$set(this.formData,"sentWhoList",t),this.$set(this.formData,"depData",e)},handleClose:function(){this.dialogVisible=!1},checkInfos:function(t){this.relevanceAll=t}},destroyed:function(){this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)}},d=(s("BZ7v"),s("ZrdR")),u=Object(d.a)(m,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("create-view",{attrs:{"body-style":{height:"100%"}}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.newLoading,expression:"newLoading"}],staticClass:"new-journal"},[i("div",{staticClass:"header",attrs:{slot:"header"},slot:"header"},[i("span",{staticClass:"text"},[t._v(t._s(t.dialogTitle))]),t._v(" "),i("img",{staticClass:"el-icon-close rt",attrs:{src:s("cjwK"),alt:""},on:{click:t.close}})]),t._v(" "),i("div",{staticClass:"content"},[i("el-tabs",{on:{"tab-click":t.tabClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},t._l(t.tabsData,function(t,e){return i("el-tab-pane",{key:e,attrs:{label:t.label,name:t.key}})})),t._v(" "),i("div",{staticClass:"form"},[t._l(t.formList,function(e,s){return i("div",{key:s,staticClass:"row-list"},[i("label",{staticClass:"item-label"},[t._v(t._s(e.label)+"：")]),t._v(" "),i("el-input",{attrs:{type:"textarea",autosize:{minRows:4},placeholder:"请输入内容",resize:"none"},model:{value:t.formData[e.model],callback:function(s){t.$set(t.formData,e.model,s)},expression:"formData[item.model]"}})],1)}),t._v(" "),i("div",{staticClass:"img-accessory"},[i("div",{staticClass:"img-box"},[i("el-upload",{ref:"imageUpload",attrs:{action:t.crmFileSaveUrl,headers:t.httpHeader,name:"file",data:{type:"img",batchId:t.batchId},multiple:"",accept:"image/*","list-type":"picture-card","on-preview":t.handleFilePreview,"before-remove":t.beforeRemove,"on-success":t.imgFileUploadSuccess,"file-list":t.imageFileList}},[i("p",{staticClass:"add-img"},[i("span",{staticClass:"el-icon-picture"}),t._v(" "),i("span",[t._v("添加图片")])]),t._v(" "),i("i",{staticClass:"el-icon-plus"})])],1),t._v(" "),i("p",{staticClass:"add-accessory"},[i("el-upload",{ref:"fileUpload",attrs:{action:t.crmFileSaveUrl,headers:t.httpHeader,name:"file",data:{type:"file",batchId:t.batchId},multiple:"",accept:"*.*","on-preview":t.handleFilePreview,"before-remove":t.handleFileRemove,"on-success":t.fileUploadSuccess,"file-list":t.fileList}},[i("p",[i("img",{attrs:{src:s("6KEE"),alt:""}}),t._v("\n                添加附件\n              ")])])],1)]),t._v(" "),i("div",{staticClass:"sent-who"},[i("span",{staticClass:"label"},[t._v("发送给谁:")]),t._v(" "),t._l(t.formData.sentWhoList,function(e,s){return i("div",{directives:[{name:"photo",rawName:"v-photo",value:e,expression:"k"},{name:"lazy",rawName:"v-lazy:background-image",value:t.$options.filters.filterUserLazyImg(e.img),expression:"$options.filters.filterUserLazyImg(k.img)",arg:"background-image"}],key:s,staticClass:"div-photo k-img header-circle"})}),t._v(" "),i("span",t._l(t.formData.depData,function(e,s){return i("span",{key:s,staticClass:"item-name"},[t._v(t._s(e.name))])})),t._v(" "),i("members-dep",{attrs:{userCheckedData:t.formData.sentWhoList,depCheckedData:t.formData.depData,contentBlock:!1},on:{popoverSubmit:t.popoverSubmit}},[i("img",{staticClass:"sent-img",attrs:{slot:"membersDep",src:s("xVxq")},slot:"membersDep"})])],2),t._v(" "),i("related-business",{attrs:{marginLeft:"0",allData:t.allData},on:{checkInfos:t.checkInfos}})],2)],1),t._v(" "),i("div",{staticClass:"btn-group"},[i("el-button",{attrs:{type:"primary"},on:{click:t.submitBtn}},[t._v("提交")]),t._v(" "),i("el-button",{on:{click:t.close}},[t._v("取消")])],1)])])},[],!1,null,"c33dc6d6",null);u.options.__file="newDialog.vue";e.default=u.exports}}]);